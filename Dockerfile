# Stage 1: Build Stage
FROM maven:3.8.4 AS build
ENV CONFIGSTORECONNECTOR_CONTEXTPATH=/api/connector/configstore
ENV CONFIGSTORECONNECTOR_HOST=http://localhost:8082/
ENV ENCRYPTION_SECRET_KEY=000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F
ENV LOAN_DB_GET_CUSTOMER_LOAN_DETAILS_CONTEXTPATH=/api/customer/v1/
ENV LOAN_DB_GET_CUSTOMER_LOAN_DETAILS_HOST=https://9b66fe71-04de-4d62-a371-7b362d126391.mock.pstmn.io
ENV LOAN_DB_NEW_LOAN_APPLICATION_CONTEXTPATH=/api/loan/v1/
ENV LOAN_DB_NEW_LOAN_APPLICATION_HOST=https://10fdf6f7-766e-44fe-b914-689f040264e9.mock.pstmn.io
WORKDIR /app
RUN git clone https://github.com/sagnikc2001/LoanAPI.git
WORKDIR /app/LoanAPI
RUN mvn install

# Stage 2: Runtime Stage
FROM registry.access.redhat.com/ubi8/openjdk-11
EXPOSE 8081
ENV CONFIGSTORECONNECTOR_CONTEXTPATH=/api/connector/configstore
ENV CONFIGSTORECONNECTOR_HOST=http://localhost:8082/
ENV ENCRYPTION_SECRET_KEY=000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F
ENV LOAN_DB_GET_CUSTOMER_LOAN_DETAILS_CONTEXTPATH=/api/customer/v1/
ENV LOAN_DB_GET_CUSTOMER_LOAN_DETAILS_HOST=https://9b66fe71-04de-4d62-a371-7b362d126391.mock.pstmn.io
ENV LOAN_DB_NEW_LOAN_APPLICATION_CONTEXTPATH=/api/loan/v1/
ENV LOAN_DB_NEW_LOAN_APPLICATION_HOST=https://10fdf6f7-766e-44fe-b914-689f040264e9.mock.pstmn.io
WORKDIR /app
COPY --from=build /app/LoanAPI/target/LoanAPI.jar .
ENTRYPOINT ["java", "-jar", "LoanAPI.jar"]
